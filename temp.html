<html>

<head>
  <style>
    body {
      font-family: sans-serif;
      overflow-x: hidden;
    }

    h1 {
      margin-bottom: 0;
    }

    .todoList {
      list-style-type: none;
      list-style-position: inside;
      padding-left: 0;
    }

    .checked {
      text-decoration: line-through;
      text-decoration-color: red;
      brightness: 0.5;
      opacity: 0.5;
    }

    .text {
      min-width: 32ch;
      background-color: transparent;
      border: 0;
      padding: 5px;
      margin: 0;
      outline: none;
      resize: none;
      font-family: inherit;
      font-size: 15px;
      overflow: hidden;
      width: 100%;
    }

    input[type="text"] {
      transition: 0.4s ease-in-out;
    }

    input:focus {
      outline: none;
      border-bottom: 1px solid;
    }

    .add_button {
      width: 20px;
      height: 20px;
      background-color: #ffffff59;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      margin-left: 10px;
      margin-right: 10px;
      opacity: 0;
      /* make the button invisible initially */
      transition: opacity 0.3s;
    }

    .container {
      display: flex;
      flex-direction: row;
      align-items: center;
    }

    .container:hover .add_button {
      opacity: 1;
      /* make the button visible when the container is hovered */
    }

    h2,
    h3,
    h4 {
      margin: 0;
    }

    .h1 {
      font-size: 2em;
      font-weight: bold;
      outline: none;
      border: none;
    }

    .h2 {
      font-size: 1.5em;
      font-weight: bold;
      outline: none;
      border: none;
    }

    .h3 {
      font-size: 1em;
      font-weight: bold;
      outline: none;
      border: none;
    }

    .tooltipList {
      position: absolute;
      width: 80px;
      top: 0;
      left: 0;
      list-style: none;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: none;
      opacity: 0.9;
    }

    .tooltipList li {
      border-bottom: 1px solid #bbbbbb;
    }

    .tooltipList li button {
      outline: none;
      border: none;
      padding: 5px;
      width: 100%;
      text-align: left;
      cursor: pointer;
    }

    .tooltipList li button:last-child {
      border-bottom: none;
    }

    .tooltipList li button:hover {
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="tooltipList" id="tooltipList"></div>
  <h1>All Content</h1>
  Created on: 1/14/2024, 11:49:25 AM<br />
  Last updated on: 1/30/2024, 12:00:04 AM<br />
  <hr />
  <div class="container"> <button class="add_button" onclick="addElement()">+</button>
    <h1><INPUT id="0" class="text h1" tabindex="0" placeholder="Heading 1" name="editor"
        value='This is first Heading' /></h1>
  </div>
  <div class="container"> <button class="add_button" onclick="addElement()">+</button>
    <h2><INPUT id="1" class="text h2" tabindex="1" placeholder="Heading 2" name="editor"
        value='This is second heading' /></h2>
  </div>
  <div class="container"> <button class="add_button" onclick="addElement()">+</button>
    <h3><INPUT id="6" class="text h3" tabindex="6" placeholder="Heading 3" name="editor" value='This is Heading 3' />
    </h3>
  </div>
  <div class="container"> <button class="add_button" onclick="addElement()">+</button>
    <h1><INPUT id="13" class="text h1" tabindex="13" placeholder="Heading 1" name="editor" value='This is heading 1' />
    </h1>
  </div>
  <div class="container"> <button class="add_button" onclick="addElement()">+</button><textarea id="22"
      class="text normalText" tabindex="22" placeholder="type '/' to enter command mode"
      name="editor">This is text</textarea> <br /></div>
  <ul id="32">
    <div class="container"> <button class="add_button" onclick="addElement()">+</button>
      <li><INPUT id="33" class="text listText" tabindex="33" placeholder="type '/' to enter command mode" name="editor"
          value='This is bullet 1' /></li> <br />
    </div>
    <div class="container"> <button class="add_button" onclick="addElement()">+</button>
      <li><INPUT id="34" class="text listText" tabindex="34" placeholder="type '/' to enter command mode" name="editor"
          value='This is bullet 2' /></li> <br />
    </div>
  </ul>
  <ul class="todoList">
    <div class="container"> <button class="add_button" onclick="addElement()">+</button>
      <li><input type="checkbox" id="44_box" name="todo_box"><INPUT id="44" class="text todoText" tabindex="44"
          placeholder="type '/' to enter command mode" name="editor" value='This is unchecked' /></li>
    </div>
    <div class="container"> <button class="add_button" onclick="addElement()">+</button>
      <li class="checked"><input type="checkbox" id="45_box" name="todo_box" checked><INPUT id="45"
          class="text checked todoText" tabindex="45" placeholder="type '/' to enter command mode" name="editor"
          value='This is checked' /></li>
    </div>
  </ul>
  <div class="container"> <button class="add_button" onclick="addElement()">+</button><textarea id="48"
      class="text normalText" tabindex="48" placeholder="type '/' to enter command mode" style="height: fit-content;" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'
      name="editor">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Sit amet est placerat in egestas. Consectetur adipiscing elit duis tristique sollicitudin nibh sit. Lectus mauris ultrices eros in. Adipiscing elit pellentesque habitant morbi tristique senectus. Cras pulvinar mattis nunc sed blandit libero volutpat sed. Diam vulputate ut pharetra sit amet aliquam id. Odio pellentesque diam volutpat commodo sed egestas egestas fringilla phasellus. Faucibus ornare suspendisse sed nisi lacus. Est sit amet facilisis magna. Sagittis nisl rhoncus mattis rhoncus urna neque viverra. Vehicula ipsum a arcu cursus vitae congue mauris. Fermentum iaculis eu non diam phasellus vestibulum. Massa placerat duis ultricies lacus sed turpis tincidunt id.  Neque laoreet suspendisse interdum consectetur libero id faucibus nisl. Lectus quam id leo in vitae turpis massa sed elementum. Eget arcu dictum varius duis. Egestas maecenas pharetra convallis posuere. Ultrices mi tempus imperdiet nulla malesuada pellentesque elit eget gravida. Risus pretium quam vulputate dignissim suspendisse in. Quam vulputate dignissim suspendisse in est. Posuere ac ut consequat semper viverra nam. Tortor at risus viverra adipiscing at in tellus. Sit amet facilisis magna etiam tempor orci eu. Cursus sit amet dictum sit amet justo donec enim diam. Velit laoreet id donec ultrices. Ligula ullamcorper malesuada proin libero nunc consequat interdum. Laoreet non curabitur gravida arcu ac tortor dignissim convallis aenean. Duis ultricies lacus sed turpis tincidunt id aliquet risus. Faucibus a pellentesque sit amet porttitor eget dolor morbi non. Donec et odio pellentesque diam volutpat commodo sed egestas egestas. A diam sollicitudin tempor id eu nisl nunc mi. Convallis convallis tellus id interdum velit.  Massa id neque aliquam vestibulum morbi blandit. Semper quis lectus nulla at. Aliquam vestibulum morbi blandit cursus risus at ultrices. Pulvinar pellentesque habitant morbi tristique senectus. Risus nec feugiat in fermentum. Vitae congue eu consequat ac felis donec et odio pellentesque. Lobortis mattis aliquam faucibus purus in massa tempor. Volutpat maecenas volutpat blandit aliquam etiam erat velit scelerisque in. Nunc sed blandit libero volutpat sed cras ornare arcu. Massa tempor nec feugiat nisl pretium fusce id. Cras adipiscing enim eu turpis egestas pretium aenean pharetra magna. Leo in vitae turpis massa sed elementum. Neque viverra justo nec ultrices dui sapien eget. Pellentesque habitant morbi tristique senectus et netus et malesuada.  Potenti nullam ac tortor vitae purus faucibus ornare suspendisse sed. Sodales neque sodales ut etiam sit. Aliquet bibendum enim facilisis gravida. Cursus euismod quis viverra nibh cras pulvinar mattis nunc. Dictum varius duis at consectetur lorem. Orci nulla pellentesque dignissim enim sit amet. Viverra ipsum nunc aliquet bibendum enim facilisis gravida neque. Semper quis lectus nulla at volutpat. Non odio euismod lacinia at. Fames ac turpis egestas integer eget. Amet porttitor eget dolor morbi non arcu risus. Sollicitudin aliquam ultrices sagittis orci a scelerisque. Lorem sed risus ultricies tristique nulla aliquet enim tortor at. Elementum facilisis leo vel fringilla est. Justo donec enim diam vulputate ut pharetra sit amet. Ac odio tempor orci dapibus ultrices in iaculis nunc. Pretium nibh ipsum consequat nisl vel.  At erat pellentesque adipiscing commodo elit at imperdiet dui accumsan. Condimentum lacinia quis vel eros. Faucibus turpis in eu mi bibendum neque egestas. Eu scelerisque felis imperdiet proin fermentum leo vel orci. Quis eleifend quam adipiscing vitae proin sagittis nisl rhoncus. Nulla facilisi morbi tempus iaculis urna id volutpat. Malesuada fames ac turpis egestas maecenas pharetra convallis. Nunc lobortis mattis aliquam faucibus purus in massa tempor. Et netus et malesuada fames ac turpis egestas integer. Cursus mattis molestie a iaculis at erat. Pulvinar proin gravida hendrerit lectus a.</textarea>
    <br /></div>
  <div class="container">
    <INPUT id="newItem" class="text" tabindex="-1" placeholder="type '/' to add new element" name="editor" value='' />
    <br />
  </div>
  <br />
</body>

<script>
  const vscode = acquireVsCodeApi();
  let commandMode = false;

  const actionElements = {
    h1: {
      type: "h1",
      content: "",
      id: 1,
    },
    h2: {
      type: "h2",
      content: "",
      id: 2,
    },
    h3: {
      type: "h3",
      content: "",
      id: 3,
    },
    todoList: {
      type: "todoList",
      content: [
        {
          type: "todoItem",
          content: "",
          done: false,
          id: 4,
        }
      ],
      id: 9,
    },
    text: {
      type: "text",
      content: "",
      id: 16,
    },
    "bullet List": {
      type: "bl",
      content: [
        {
          type: "text",
          content: "",
          id: 10,
        }
      ],
      id: 17,
    },
  };
  const textInput = document.getElementById("newItem");
  if (textInput) {
    textInput.addEventListener("keydown", function (event) {
      if (event.key === "/") {
        commandMode = true;
      }
    });
  }

  const addElement = () => {
    let element = {
      type: "text",
      content: "adding test",
      id: 100,
    };
    vscode.postMessage({
      command: "addElement",
      element: element,
    });
  };
  function populateListAction(elementName) {
    elementName = elementName.replace("/", "");

    document.getElementById("tooltipList").innerHTML = "";
    const tooltipList = document.getElementById("tooltipList");
    for (const [key, value] of Object.entries(actionElements)) {
      if (key.includes(elementName)) {
        let li = document.createElement("li");
        li.setAttribute("id", key);
        let button = document.createElement("button");
        button.innerHTML = key;
        button.addEventListener("click", function () {
          vscode.postMessage({
            command: "addElement",
            element: value,
          });
        });
        li.appendChild(button);
        tooltipList.appendChild(li);
      }
    }
  }

  //Shift focus to newly added element
  window.addEventListener("message", (event) => {
    const message = event.data;
    switch (message.command) {
      case "updateFocus":
        console.log("Updating focus: " + message.id);
        document.getElementById(message.id).focus();
        break;
    }
  }
  );

  document.getElementsByName("editor").forEach((e) => {
    e.addEventListener("keydown", function (event) {
      if (commandMode) {
        populateListAction(event.target.value + event.key);
      }
      if (event.key === "/") {
        // Show command menu
        let tootTip = document.getElementById("tooltipList");
        tootTip.style.display = "block";
        const caretPosition = getCaretCoordinates();

        tootTip.style.top = caretPosition.y + 30 + "px";
        tootTip.style.left = caretPosition.x + "px";
        commandMode = true;

        populateListAction(event.target.value);
      }
      if (event.key === "Escape") {
        // Hide command menu
        document.getElementById("tooltipList").style.display = "none";
        document.getElementById("tooltipList").innerHTML = "";
        commandMode = false;
      }
      if (event.key === " ") {
        // Hide command menu
        document.getElementById("tooltipList").style.display = "none";
        document.getElementById("tooltipList").innerHTML = "";
        commandMode = false;
      }
      if (event.key === "Backspace") {
        // Hide command menu
        document.getElementById("tooltipList").style.display = "none";
        document.getElementById("tooltipList").innerHTML = "";
        commandMode = false;
        if (event.target.value === "") {
          vscode.postMessage({
            command: "deleteElement",
            id: event.target.id,
          });
        }
      }
      if (event.key === "Enter") {
        //Check if in command Mode
        if (commandMode) {
          populateListAction(event.target.value);
          //get the first element in command menu
          const firstElement = document.getElementById("tooltipList")
          //add new element
          let actionKey = firstElement.firstElementChild.id;
          let element = actionElements[actionKey];

          if (event.target.classList.contains("normalText")) {
            vscode.postMessage({
              command: "swapToNewElement",
              id: event.target.id,
              element: element,
            });
          }
          else {
            vscode.postMessage({
              command: "addElement",
              element: element,
            });
          }


          // Hide command menu
          document.getElementById("tooltipList").style.display = "none";
          document.getElementById("tooltipList").innerHTML = "";
          commandMode = false;
        }
        else {
          console.log(event.target.classList);
          if (event.target.classList.contains("todoText")) {
            // Add new todo item
            console.log("Adding new todo item");
            let element = {
              type: "todoItem",
              content: "",
              done: false,
              id: 100,
              sibling_id: event.target.id
            };
            vscode.postMessage({
              command: "addElement",
              element: element,
            });
          }
          else if (event.target.classList.contains("listText")) {
            console.log("Adding new list item");
            // Add new  list item
            let element = {
              type: "listText",
              content: "",
              id: 100,
              sibling_id: event.target.id
            };
            vscode.postMessage({
              command: "addElement",
              element: element,
            });
          }
          else {
            // Add new  text item
            let element = {
              type: "text",
              content: "",
              id: 100,
            };
            vscode.postMessage({
              command: "addElement",
              element: element,
            });
          }
        }
      }
    });


    e.onchange = (event) => {
      console.log("onchange");
      let id = event.target.id;
      let content = event.target.value;
      console.log("id: " + id);
      console.log("content: " + content);

      // Update the content
      vscode.postMessage({
        command: "updateContent",
        id: id,
        content: content,
      });
    }
  });


  document.getElementsByName("todo_box").forEach((e) => {
    e.onchange = (event) => {
      let id = event.target.id.replace("_box", "");
      vscode.postMessage({
        command: "toggleTodoItem",
        id: id,
      });
    }

  });

  function getCaretCoordinates() {
    let x = 0,
      y = 0;
    let focused = document.activeElement;
    if (!focused) {
      return { x, y };
    }
    const rect = focused.getBoundingClientRect();
    x = rect.left + focused.selectionStart;
    y = rect.top + focused.selectionEnd;

    return { x, y };
  }

</script>

</html>